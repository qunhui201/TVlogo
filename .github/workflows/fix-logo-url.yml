name: 修复台标链接 → 官方加速版（Gcore）

on:
  workflow_dispatch:    # 手动触发即可

jobs:
  fix-logo:
    runs-on: ubuntu-latest
    permissions:
      contents: write     # 必须有写权限

    steps:
      - name: Checkout 仓库
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: 替换为官方加速链接（Gcore）
        run: |
          find . -type f \( -name "*.m3u" -o -name "*.txt" -o -name "*.yaml" -o -name "*.yml" \) -print0 | while IFS= read -r -d '' file; do
            echo "正在处理: $file"
            # 把 jsDelivr 版全部换成 Gcore 官方加速版
            sed -i 's|https://cdn\.jsdelivr\.net/gh/qunhui201/logo@TVlogo_Images|https://ghproxy.com/https://raw.githubusercontent.com/qunhui201/logo/main/TVlogo_Images|g' "$file"
          done

      - name: 提交并推送
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions@github.com"
          git add .
          git commit -m "修复台标链接 → 官方加速版（ghproxy.com）" || echo "没有需要提交的更改"
          git push origin main

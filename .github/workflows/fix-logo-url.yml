name: 终极砍套娃（一次彻底干净）

on: workflow_dispatch

jobs:
  clean:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
      - uses: actions/checkout@v4
        with:
          token: ${{ secrets.PAT_TOKEN }}

      - name: 一次砍干净所有多余 kenyu.ggff.net（不管多少层）
        run: |
          find . -type f \( -name "*.m3u" -o -name "*.txt" -o -name "*.yaml" -o -name "*.yml" \) -print0 | xargs -0 sed -i 's|kenyu\.ggff\.net/https://kenyu\.ggff\.net|kenyu.ggff.net|g'

      - name: 提交
        run: |
          git config user.name "final-clean"
          git config user.email "clean@github.com"
          git add .
          git commit -m "终极砍套娃：所有链接只剩一个 kenyu.ggff.net" || echo "无改动"
          git push
